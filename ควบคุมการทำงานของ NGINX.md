# NGINX

> ใน NGINX มีสองกระบวนการหลักที่ทำงานร่วมกันเพื่อจัดการกับการทำงานของเซิร์ฟเวอร์ ได้แก่ Master Process และ Worker Processes แต่ละกระบวนการมีหน้าที่และบทบาทที่แตกต่างกัน ดังนี้

  1. Master Process (กระบวนการหลัก)
    - ทำหน้าที่ควบคุมและจัดการ Worker Processes ทั้งหมด
    - อ่านและวิเคราะห์ไฟล์การตั้งค่า
    - เปิดพอร์ตการฟัง (Listening Ports) เพื่อเตรียมรับการเชื่อมต่อ
    - จัดการสัญญาณ (signals) เช่น การเริ่มต้นใหม่ (restart) หรือการปิดการทำงาน (shutdown)

  2. Worker Processes (กระบวนการทำงาน):
    - ทำหน้าที่จัดการการเชื่อมต่อและการร้องขอ (requests) จากผู้ใช้
    - ประมวลผลการร้องขอและส่งการตอบกลับ (responses) ไปยังผู้ใช้
    - ทำงานคู่ขนานกันเพื่อเพิ่มประสิทธิภาพในการรับส่งข้อมูล
     
### ความแตกต่าง

- Master Process ทำหน้าที่เป็นผู้จัดการ ควบคุมและดูแลการทำงานของ Worker Processes แต่ไม่จัดการกับการร้องขอโดยตรง
- Worker Processes เป็นผู้ที่ทำงานจริงๆ ในการจัดการการร้องขอและการตอบกลับจากผู้ใช้ ทำให้สามารถรับการเชื่อมต่อหลายๆ ครั้งพร้อมกันได้

> [!NOTE]
> ### ตัวอย่างง่ายๆ
> คิดว่า NGINX เป็นร้านอาหาร
>   - Master Process เป็นผู้จัดการร้านที่ดูแลการทำงานของพนักงานทั้งหมด ควบคุมดูแลการทำงานและแก้ปัญหาต่างๆ
>   - Worker Processes เป็นพนักงานเสิร์ฟที่คอยรับออร์เดอร์จากลูกค้า นำออร์เดอร์ไปให้เชฟ และนำอาหารมาเสิร์ฟให้ลูกค้า
> ผู้จัดการร้าน (Master Process) จะดูแลและสั่งการพนักงาน (Worker Processes) เพื่อให้การบริการลูกค้าเป็นไปอย่างราบรื่นและมีประสิทธิภาพ

============================================================================================

## คำสั่งควบคุมการทำงานของ NGINX

# start

```
systemctl start nginx
```

  - คำสั่ง `systemctl start nginx` ใช้สำหรับเริ่มต้นการทำงานของบริการ NGINX บนระบบปฏิบัติการ Linux ที่ใช้ systemd เป็นระบบจัดการบริการ (services) และเดมอน (daemons) นี่คือคำอธิบายและตัวอย่างเพื่อให้เข้าใจง่าย

> ### คำสั่งเหล่านี้ใช้ในการจัดการเซิร์ฟเวอร์ NGINX โดยใช้สัญญาณ (signals) เพื่อควบคุมการทำงานของ NGINX

# reload

```
nginx -s reload
```

  - คำสั่งนี้ใช้เพื่อให้ NGINX โหลดไฟล์การตั้งค่า (configuration) ใหม่โดยไม่ต้องหยุดเซิร์ฟเวอร์ ข้อมูลใหม่จะถูกนำมาใช้ทันที
  - ตัวอย่าง : หากคุณแก้ไขไฟล์ nginx.conf และต้องการให้การตั้งค่าใหม่มีผล คุณสามารถใช้คำสั่งนี้เพื่อโหลดการตั้งค่าใหม่

# reopen

```
nginx -s reopen
```

  - คำสั่งนี้ใช้เพื่อให้ NGINX เปิดไฟล์ล็อกใหม่ โดยเฉพาะมีประโยชน์เมื่อมีการหมุนเวียนล็อก (log rotation)
  - ตัวอย่าง เมื่อมีการหมุนเวียนไฟล์ล็อก (เช่น access.log และ error.log) คำสั่งนี้จะทำให้ NGINX เปิดไฟล์ล็อกใหม่และเริ่มบันทึกข้อมูลในไฟล์ใหม่

# quit

```
nginx -s quit
```

  - คำสั่งนี้ใช้เพื่อหยุดเซิร์ฟเวอร์ NGINX อย่างสงบ (graceful shutdown) โดยจะรอให้การประมวลผลที่ยังค้างอยู่เสร็จสิ้นก่อนจึงจะหยุดการทำงาน
  - ตัวอย่าง เมื่อคุณต้องการหยุดเซิร์ฟเวอร์ NGINX เพื่อทำการอัปเดตหรือบำรุงรักษา คุณสามารถใช้คำสั่งนี้เพื่อปิดการทำงานของเซิร์ฟเวอร์อย่างปลอดภัย

# stop

```
nginx -s stop
```

  - คำสั่งนี้ใช้เพื่อหยุดเซิร์ฟเวอร์ NGINX ทันที (forceful shutdown) โดยไม่รอให้การประมวลผลที่ยังค้างอยู่เสร็จสิ้น
  - ตัวอย่าง เมื่อคุณต้องการหยุดเซิร์ฟเวอร์ NGINX ทันทีในกรณีฉุกเฉิน เช่น เมื่อมีปัญหารุนแรงหรือเมื่อเซิร์ฟเวอร์ไม่ตอบสนอง

> ### คำสั่ง kill -s <signal> <master qid> ใช้ในการส่งสัญญาณ (signal) จากโปรแกรมหรือกระบวนการที่กำลังทำงานให้กับโปรแกรมหรือกระบวนการนั้นๆ ซึ่ง kill คือคำสั่งที่ใช้ในการสิ้นสุดการทำงานของโปรแกรมหรือกระบวนการนั้นๆ ส่วน -s คือตัวเลือกในการระบุสัญญาณ และ <master qid> คือ ID หรือชื่อของโปรแกรมหรือกระบวนการนั้นๆ ที่ต้องการส่งสัญญาณ

### ตัวอย่างของสัญญาณและการใช้งานคำสั่ง

# reload (SIGHUP)

```
kill -s SIGHUP <master qid>
```

  - ใช้ส่งสัญญาณ SIGHUP เพื่อโหลดค่าการกำหนดค่าใหม่ของโปรแกรมหรือกระบวนการนั้นๆ โดยทั่วไปใช้ในการโหลดการกำหนดค่าใหม่หลังจากการแก้ไขไฟล์คอนฟิกหรือการปรับเปลี่ยนการตั้งค่า

# reopen (SIGUSR1)

```
kill -s SIGUSR1 <master qid>
```

  - ใช้ส่งสัญญาณ SIGUSR1 เพื่อให้โปรแกรมหรือกระบวนการนั้นๆ เปิดไฟล์ log ใหม่ โดยทั่วไปใช้ในการเปิดไฟล์ log ใหม่เมื่อไฟล์ log เก่ามีขนาดใหญ่เกินไปหรือต้องการสร้างไฟล์ log ใหม่

# quit (SIGQUIT)

```
kill -s SIGQUIT <master qid>
```

  - ใช้ส่งสัญญาณ SIGQUIT เพื่อสั่งให้โปรแกรมหรือกระบวนการนั้นๆ หยุดทำงานและออกจากระบบโดยสมบูรณ์ โดยทั่วไปใช้ในการจบการทำงานของโปรแกรม

# stop (SIGSTOP)

```
kill -s SIGSTOP <master qid>
```

  - ใช้ส่งสัญญาณ SIGSTOP เพื่อระงับการทำงานของโปรแกรมหรือกระบวนการนั้นๆ โดยไม่สิ้นสุดการทำงาน โปรแกรมจะหยุดทำงานแต่ยังคงอยู่ในระบบ เพื่อทำการตรวจสอบข้อผิดพลาดหรือปรับแต่งการทำงานในภายหลัง

> [!NOTE]
> โดยสัญญาณและการใช้งานนี้อาจมีการใช้งานเพิ่มเติมหรือแตกต่างกันไปในบางกรณี ขึ้นอยู่กับโปรแกรมหรือกระบวนการที่กำลังทำงาน ควรตรวจสอบเอกสารหรือคู่มือที่เกี่ยวข้องกับโปรแกรมหรือกระบวนการนั้นๆ ก่อนใช้คำสั่งนี้ในสถานการณ์จริง
============================================================================================
